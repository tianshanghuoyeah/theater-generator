# 小剧场生成器 - 模块化版本

## 📁 文件结构

```
theater-generator/
├── theater-generator.js      # 主文件，包含API设置和模块集成
├── theater-module.js         # 小剧场模块（独立）
├── diary-module.js           # 日记模块（独立）
├── wallpaper-module.js       # 壁纸模块（独立）
├── theater-modules.css       # 模块样式文件
└── README.md                 # 说明文档
```

## 🎭 功能模块

### 1. 小剧场模块 (`theater-module.js`)
- **功能**: 生成HTML格式的小剧场场景，包含对话和动作描述
- **特色**: 
  - **消息阈值监控**：进度条显示当前消息数量，默认需要10层消息才能生成
  - **提示词预设模版**：8种不同风格（悬疑反转、古风宫廷、校园欢喜冤家、赛博朋克、现代都市、奇幻冒险、科幻未来、历史穿越）
  - **智能API生成**：基于聊天历史和用户提示词生成HTML格式小剧场
  - **HTML预览**：美观的HTML格式展示，包含对话、舞台指示和叙述
  - **截图功能**：一键截图保存生成的小剧场
  - **历史记录管理**：自动保存生成历史
- **使用**: 点击主界面的"🎭 小剧场"按钮

### 2. 日记模块 (`diary-module.js`)
- **功能**: 生成各种风格的日记
- **特色**:
  - 多种风格选择（古风、校园风、现代风、杂志风）
  - 可调节日记长度（200-1000字）
  - 预设模版（学习反思、古风、校园风等）
- **使用**: 点击主界面的"📝 日记"按钮

### 3. 壁纸模块 (`wallpaper-module.js`)
- **功能**: 设置和管理壁纸
- **特色**:
  - 支持文件上传和在线URL
  - 可调节透明度和模糊度
  - 拖拽上传支持
- **使用**: 点击主界面的"🖼️ 壁纸"按钮

## ⚙️ API设置

所有模块都共享同一个API配置，支持：
- **OpenAI API**: 标准ChatGPT API
- **Google Gemini**: Gemini API
- **自定义API**: 兼容OpenAI格式的API

## 🎨 样式特点

- 基于参考代码的样式设计
- 响应式布局，支持手机和桌面
- 统一的UI风格和交互体验
- 现代化的按钮和表单设计

## 🚀 使用方法

1. **加载插件**: 确保所有文件都在同一目录下
2. **配置API**: 点击"⚙️ API设置"配置你的API密钥
3. **使用功能**: 
   - 点击"🎭 小剧场"生成小剧场场景
   - 点击"📝 日记"生成各种风格的日记
   - 点击"🖼️ 壁纸"设置和管理壁纸

## 🔧 技术特点

### 模块化设计
- 每个功能都是独立的模块，便于维护和修改
- 统一的接口设计，易于扩展新功能
- 独立的localStorage存储，避免数据冲突

### API集成
- 支持多种API提供商
- 自动降级到模拟生成（API不可用时）
- 统一的错误处理和用户提示
- 使用酒馆助手API获取聊天历史
- 智能提示词构建，结合聊天上下文

### 用户体验
- 加载状态提示
- 错误处理和用户反馈
- 返回按钮和模态框关闭
- 响应式设计
- 支持html2canvas截图库
- 实时进度条和状态显示

## 📝 自定义修改

### 修改小剧场模块
编辑 `theater-module.js` 文件：
- 修改预设模版：在 `getContent()` 方法中更新选项
- 调整消息阈值：修改 `loadSettings()` 方法中的默认值
- 调整生成逻辑：修改 `generateSampleTheater()` 方法
- 更改API提示词：修改 `buildTheaterPrompt()` 方法中的system prompt
- 自定义HTML样式：修改 `generateHTMLTheater()` 方法
- 调整截图功能：修改 `takeScreenshot()` 方法

### 修改日记模块
编辑 `diary-module.js` 文件：
- 添加新风格：在 `generateSampleDiary()` 方法中添加新样式
- 修改长度范围：在HTML模板中调整range的min/max值
- 更新预设模版：在 `getContent()` 方法中添加新选项

### 修改壁纸模块
编辑 `wallpaper-module.js` 文件：
- 调整默认设置：修改 `loadSettings()` 方法中的默认值
- 添加新功能：在 `bindEvents()` 方法中添加新的事件处理
- 修改样式：更新 `theater-modules.css` 文件

## 🐛 调试功能

主文件提供了丰富的调试命令，在浏览器控制台中输入：

```javascript
// 检查API配置状态
window.debugTheaterAPI()

// 测试保存功能
window.testSaveFunction()

// 检查保存按钮状态
window.checkSaveButton()

// 重新绑定保存按钮
window.rebindSaveButton()
```

## 📋 注意事项

1. **文件路径**: 确保所有模块文件都在同一目录下
2. **API配置**: 首次使用需要配置API密钥
3. **浏览器兼容**: 支持现代浏览器，需要localStorage支持
4. **网络访问**: API功能需要网络连接

## 🔄 更新日志

- **v1.1.0**: 小剧场模块重大更新
  - 添加消息阈值监控功能（进度条显示）
  - 集成酒馆助手API获取聊天历史
  - 实现HTML格式小剧场生成和预览
  - 添加截图功能（支持html2canvas）
  - 扩展提示词预设模版（8种风格）
  - 优化用户体验和界面设计

- **v1.0.0**: 初始版本，集成三个核心功能模块
- 基于参考代码 `C:\Users\Administrator\Desktop\mobile\theater-generator` 重构
- 解决保存按钮ID冲突问题
- 添加完整的调试和错误处理功能
